<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Road To Excelsior">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Road To Excelsior">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Robinson">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Road To Excelsior</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Road To Excelsior</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/01/12/profile%E3%80%81bash-profile%E3%80%81bashrc%E3%80%81zshrc%E6%96%87%E4%BB%B6%E7%9A%84%E4%BD%9C%E7%94%A8%E4%B8%8E%E5%8C%BA%E5%88%AB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Robinson">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Road To Excelsior">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/12/profile%E3%80%81bash-profile%E3%80%81bashrc%E3%80%81zshrc%E6%96%87%E4%BB%B6%E7%9A%84%E4%BD%9C%E7%94%A8%E4%B8%8E%E5%8C%BA%E5%88%AB/" class="post-title-link" itemprop="url">profile、bash_profile、bashrc、zshrc文件的作用与区别</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-01-12 15:13:46 / Modified: 15:52:15" itemprop="dateCreated datePublished" datetime="2021-01-12T15:13:46+08:00">2021-01-12</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>profile、bash_profile、bashrc三个文件在Linux或类Unix系统（如：Mac）系统中经常会用到，通常用于设置系统级环境变量或者启动程序，配置函数或者别名等。</p>
<h2 id="1-profile文件"><a href="#1-profile文件" class="headerlink" title="1. profile文件"></a>1. profile文件</h2><h3 id="1-1-profile文件的作用"><a href="#1-1-profile文件的作用" class="headerlink" title="1.1 profile文件的作用"></a>1.1 profile文件的作用</h3><p>profile（/etc/profile），用于设置系统级的环境变量和启动程序，在这个文件下配置会对所有用户生效。当用户登录（login）时，文件会被执行，并从/etc/profile.d目录的配置文件中查找shell设置。</p>
<h3 id="1-2-在profile中添加环境变量"><a href="#1-2-在profile中添加环境变量" class="headerlink" title="1.2 在profile中添加环境变量"></a>1.2 在profile中添加环境变量</h3><p>一般不建议在/etc/profile文件中添加环境变量，因为在这个文件中添加的设置会对所有用户起作用。当需要添加时，我们可以按以方式添加：</p>
<p>如，添加一个HOST值为itbilu.com的环境变量：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> HOST=itbilu.com</span><br></pre></td></tr></table></figure>
<p>添加时，可以在行尾使用;号，也可以不使用。一个变量名可以对应多个变量值，多个变量值使用:分隔。</p>
<p>添加环境变量后，需要重新登录才能生效，也可以使用source命令强制立即生效：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure>
<p>查看是否生效可以使用echo命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="variable">$HOST</span></span><br><span class="line">itbilu.com</span><br></pre></td></tr></table></figure>
<h2 id="2-bashrc文件"><a href="#2-bashrc文件" class="headerlink" title="2. bashrc文件"></a>2. bashrc文件</h2><p>－这个文件用于配置函数或别名。bashrc文件有两种级别：系统级的位于/etc/bashrc、用户级的~/.bashrc，两者分别会对所有用户和当前用户生效。</p>
<p>bashrc文件只会对指定的shell类型起作用，bashrc只会被bash shell调用。</p>
<h2 id="3-bash-profile文件"><a href="#3-bash-profile文件" class="headerlink" title="3. bash_profile文件"></a>3. bash_profile文件</h2><p>bash_profile只有单一用户有效，文件存储位于~/.bash_profile，该文件是一个用户级的设置，可以理解为某一个用户的profile目录下。这个文件同样也可以用于配置环境变量和启动程序，但只针对单个用户有效。<br>和profile文件类似，bash_profile也会在用户登录（login）时生效，也可以用于设置环境变理。但与profile不同，bash_profile只会对当前用户生效。</p>
<h2 id="4-zshrc文件"><a href="#4-zshrc文件" class="headerlink" title="4.zshrc文件"></a>4.zshrc文件</h2><p>如果安装了zsh软件，则zsh加载的是 ~/.zshrc文件，需要注意的是‘.zshrc’ 文件中并没有定义任务环境变量。可以通过在.zshrc 任意一行加入如下代码是.bash_profile 在zsh中生效：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ -f ~/.bash_profile ]; then </span><br><span class="line">    . ~/.bash_profile;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<h2 id="5-总结"><a href="#5-总结" class="headerlink" title="5.总结"></a>5.总结</h2><p>当登入系统时候获得一个shell进程时，其读取环境设定顺序如下：<br><img src="/assets/16104377720249.jpg" alt="-w439"><br>所以，对于MAC系统或者其他Linux系统，如果想配置一个统一的bash环境变量配置，可以参考如下的逻辑来处理：<br><a target="_blank" rel="noopener" href="https://stackoverflow.com/a/23233967/10185626">https://stackoverflow.com/a/23233967/10185626</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/01/10/%E5%9F%BA%E4%BA%8EGradle%E4%BD%BF%E7%94%A8%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4Java%E5%BC%80%E5%8F%91%E8%A7%84%E7%BA%A6%E8%BF%9B%E8%A1%8C%E4%BB%A3%E7%A0%81%E6%A3%80%E6%9F%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Robinson">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Road To Excelsior">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/10/%E5%9F%BA%E4%BA%8EGradle%E4%BD%BF%E7%94%A8%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4Java%E5%BC%80%E5%8F%91%E8%A7%84%E7%BA%A6%E8%BF%9B%E8%A1%8C%E4%BB%A3%E7%A0%81%E6%A3%80%E6%9F%A5/" class="post-title-link" itemprop="url">基于Gradle使用阿里巴巴Java开发规约进行代码检查</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-01-10 15:12:21 / Modified: 22:30:28" itemprop="dateCreated datePublished" datetime="2021-01-10T15:12:21+08:00">2021-01-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/12/22/Springboot-%E6%9D%82%E7%83%A9/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Robinson">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Road To Excelsior">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/22/Springboot-%E6%9D%82%E7%83%A9/" class="post-title-link" itemprop="url">Springboot 杂烩</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-12-22 22:07:46" itemprop="dateCreated datePublished" datetime="2020-12-22T22:07:46+08:00">2020-12-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-23 22:07:12" itemprop="dateModified" datetime="2020-12-23T22:07:12+08:00">2020-12-23</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="各种注解"><a href="#各种注解" class="headerlink" title="各种注解"></a>各种注解</h1><h2 id="Configuration注解"><a href="#Configuration注解" class="headerlink" title="@Configuration注解"></a>@Configuration注解</h2><p>Configuration注解是spring core framework 中的一部分，Spring 的 Configuration 注解表示那个类中有@Bean的方法注解。所以spring 容器可以处理这个类，并且生成应用中使用的spring beans。<br>Configuration注解的类等同于使用 XML文件来注入的bean，不过springboot 推荐使用注解的方法来生成bean。<br>参考资源：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903842476195848">Spring管理的@Configuration注解使用
</a></li>
<li><a target="_blank" rel="noopener" href="https://www.javaguides.net/2018/09/spring-configuration-annotation-with-example.html">Spring @Configuration Annotation with Example</a><h2 id="EnableAutoConfiguration注解"><a href="#EnableAutoConfiguration注解" class="headerlink" title="@EnableAutoConfiguration注解"></a>@EnableAutoConfiguration注解</h2>这个注解实现了自动装配。打开其源码：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@AutoConfigurationPackage</span></span><br><span class="line"><span class="comment">//@Import注解是为了把某个类注入到IOC容器中,这样就可以进行自动装配啥的,也可以通过getBean获取.</span></span><br><span class="line"><span class="meta">@Import(AutoConfigurationImportSelector.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAutoConfiguration &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到其将AutoConfigurationImportSelector.class导入了容器,借助AutoConfigurationImportSelector，@EnableAutoConfiguration可以帮助SpringBoot应用将所有符合条件的@Configuration配置都加载到当前SpringBoot创建并使用的IoC容器(注意是Configuration配置)。</p>
<p>文档参见：<a target="_blank" rel="noopener" href="https://blog.csdn.net/q610376681/article/details/88578155">SpringBoot自动注入原理初解与实现</a></p>
<h1 id="Spring-Boot-读取properties-配置文件中的数据"><a href="#Spring-Boot-读取properties-配置文件中的数据" class="headerlink" title="Spring Boot 读取properties 配置文件中的数据"></a>Spring Boot 读取properties 配置文件中的数据</h1><ol>
<li>使用@Value注解</li>
<li>使用Environment来读取</li>
<li>使用@ConfigurationProperties注解读取</li>
</ol>
<p>参见：<a target="_blank" rel="noopener" href="https://blog.csdn.net/dkbnull/article/details/81953190">Spring Boot最常用的3种读取properties配置文件中数据的方法：
</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/12/19/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%EF%BC%88%E4%BA%8C%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Robinson">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Road To Excelsior">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/19/Mockito%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%EF%BC%88%E4%BA%8C%EF%BC%89/" class="post-title-link" itemprop="url">Mockito单元测试（二）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-12-19 13:38:32 / Modified: 13:58:51" itemprop="dateCreated datePublished" datetime="2020-12-19T13:38:32+08:00">2020-12-19</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="RunWith-注解"><a href="#RunWith-注解" class="headerlink" title="@RunWith 注解"></a>@RunWith 注解</h2><h3 id="RunWith的作用"><a href="#RunWith的作用" class="headerlink" title="@RunWith的作用"></a>@RunWith的作用</h3><p>@RunWith就是一个运行器</p>
<p>@RunWith(JUnit4.class)就是指用JUnit4来运行</p>
<p>@RunWith(SpringJUnit4ClassRunner.class),让测试运行于Spring测试环境</p>
<p>@RunWith(Suite.class)的话就是一套测试集合</p>
<p>备注：这里SpringRunner 继承了SpringJUnit4ClassRunner，没有扩展任何功能；使用前者，名字简短而已</p>
<h3 id="特别看看-RunWith-SpringJunit4ClassRunner-class"><a href="#特别看看-RunWith-SpringJunit4ClassRunner-class" class="headerlink" title="特别看看@RunWith(SpringJunit4ClassRunner.class)"></a>特别看看@RunWith(SpringJunit4ClassRunner.class)</h3><p>使用RunWith注解改变JUnit的默认执行类，并实现自已的Listener在平时的单元测试，如果不使用RunWith注解，那么JUnit将会采用默认的执行类Suite执行，如下类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestClass</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Test</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">t1</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>JUnit允许用户指定其它的单元测试<strong>执行类</strong>，只需要我们的测试<strong>执行类</strong>继承类org.junit.runners.BlockJUnit4ClassRunner就可以了，Spring的执行类SpringJUnit4ClassRunner就是继承了该类。我们平时用Spring也比较多，为了能够更加方便的引用配置文件，我们单元测试就使用了Spring实现的执行类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(locations = &#123; &quot;classpath*:/spring1.xml&quot;, &quot;classpath*:/spring2.xml&quot; &#125;)</span></span><br><span class="line"><span class="meta">@TestExecutionListeners( &#123; DependencyInjectionTestExecutionListener.class, TransactionalTestExecutionListener.class &#125;)</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestClass</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Inject</span></span><br><span class="line">	<span class="comment">//这个类会在执行时被注入，这里是按类型注入，如果想按名称注入，需要加上@Named注解，如@Named(&quot;class1&quot;)</span></span><br><span class="line">	<span class="comment">//实现类可以加上@Named(&quot;class1&quot;)注解，也可以是配置在配置文件中的</span></span><br><span class="line">	Class1 class1;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Test</span> </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">t1</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面注解的解释如下:<br>@RunWith：这个是指定使用的单元测试执行类，这里就指定的是SpringJUnit4ClassRunner.class；</p>
<p>@ContextConfiguration：这个指定Spring配置文件所在的路径，可以同时指定多个文件；</p>
<p>@TestExecutionListeners：这个用于指定在测试类执行之前，可以做的一些动作，如这里的DependencyInjectionTestExecutionListener.class，就可以对一测试类中的依赖进行注入，TransactionalTestExecutionListener.class用于对事务进行管理；这两个都是Srping自带的； 我们也可以实现自己的Listener类来完成我们自己的操作，只需要继续类org.springframework.test.context.support.AbstractTestExecutionListener就可以了，具体可以参照DependencyInjectionTestExecutionListener.class的实现，后面我会贴出实例。 Listener实在实现类执行之前被执行、实现类的测试方法之前被执行，这与Listener的实现有关。</p>
<p>@Transactional：这里的@Transactional不是必须的，这里是和@TestExecutionListeners中的TransactionalTestExecutionListener.class配合使用，用于保证插入的数据库中的测试数据，在测试完后，事务回滚，将插入的数据给删除掉，保证数据库的干净。如果没有显示的指定@Transactional，那么插入到数据库中的数据就是真实的插入了。</p>
<h2 id="SpringBootTest注解"><a href="#SpringBootTest注解" class="headerlink" title="@SpringBootTest注解"></a>@SpringBootTest注解</h2><p>集成测试适用于继承应用的不同层组件，这意味着没有mock对象涉及其中。当我们需要启动整个容器时，@SpringBootTest注解是非常有用的。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>@RunWith(SpringRunner.class) : 使用这个注解是在单元测试时使用springboot的一些特性，如 @Autowired, @Mockbean…等</p>
<blockquote>
<p>is used to provide a bridge between Spring Boot test features and JUnit. Whenever we are using any Spring Boot testing features in our JUnit tests, this annotation will be required. </p>
</blockquote>
<p>@SpringBootTest注解：是用在集成测试中，加载整个应用上下文到容器中。</p>
<blockquote>
<p>The @SpringBootTest annotation can be used when we need to bootstrap the entire container. The annotation works by creating the ApplicationContext that will be utilized in our tests.</p>
</blockquote>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li><a target="_blank" rel="noopener" href="https://www.baeldung.com/spring-boot-testing">Testing in Spring Boot</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/fenglibing/article/details/8584602">使用RunWith注解改变JUnit的默认执行类，并实现自已的Listener
</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/12/18/Mockito%E7%94%A8%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Robinson">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Road To Excelsior">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/18/Mockito%E7%94%A8%E6%B3%95/" class="post-title-link" itemprop="url">Mockito用法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-12-18 13:58:12" itemprop="dateCreated datePublished" datetime="2020-12-18T13:58:12+08:00">2020-12-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-19 13:36:16" itemprop="dateModified" datetime="2020-12-19T13:36:16+08:00">2020-12-19</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="1-Mockito是什么？"><a href="#1-Mockito是什么？" class="headerlink" title="1.Mockito是什么？"></a>1.Mockito是什么？</h2><p>Mockito是一个非常不错的模拟框架。 它使您可以使用干净简单的API编写漂亮的测试。 Mockito不会给您带来麻烦，因为这些测试可读性强，并且会产生清晰的验证错误。<br>想象一下这样的一个常见的场景，当前要测试的类依赖于其它一些类对象时，如果用 Junit 来进行单元测试的话，我们就必须手动创建出这些依赖的对象，这其实是个比较麻烦的工作，此时就可以使用 Mockito 测试框架来模拟那些依赖的类，这些被模拟的对象在测试中充当真实对象的虚拟对象或克隆对象，而且 Mockito 同时也提供了方便的测试行为验证。这样就可以让我们更多地去关注当前测试类的逻辑，而不是它所依赖的对象。</p>
<h2 id="2-生成Mock对象方式"><a href="#2-生成Mock对象方式" class="headerlink" title="2.生成Mock对象方式"></a>2.生成Mock对象方式</h2><h3 id="2-1-使用Mockito-mock-Clazz-方式-或者-Mock注解方式"><a href="#2-1-使用Mockito-mock-Clazz-方式-或者-Mock注解方式" class="headerlink" title="2.1 使用Mockito.mock(Clazz)方式 或者 @Mock注解方式"></a>2.1 使用Mockito.mock(Clazz)方式 或者 @Mock注解方式</h3><p>通过Mockito类的静态方法mock来创建mock对象，对对象中函数的调用均执行mock（即虚假函数），不执行真正部分。例如可以一下创建了一个List类型的Mock对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; mockList = Mockito.mock(ArrayList.class);</span><br></pre></td></tr></table></figure>

<p>使用 @Mock注解方式来创建Mock对象，使用该方式创建对象需要在运行测试方法前使用MockitoAnnotation.initMock(this) 或者在单元测试类上加上 @ExtendWith(MockitoExtension.class)注解。如下所示代码创建了一个 List 类型的 Mock 对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExtendWith(MockitoExtension.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MockitoTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Mock</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; mockList;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeEach</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeEach</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        MockitoAnnotations.initMocks(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-2-使用-spy-方式-或者-Spy注解"><a href="#2-2-使用-spy-方式-或者-Spy注解" class="headerlink" title="2.2 使用 spy 方式 或者 @Spy注解"></a>2.2 使用 spy 方式 或者 @Spy注解</h3><p>spy 与mock不同，不同点是：</p>
<ul>
<li>spy 的参数是对象示例，mock 的参数是 class。</li>
<li>被 spy 的对象，调用其方法时默认会走真实方法。mock 对象不会。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Assert;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.mockito.Mockito.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExampleService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a+b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MockitoDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试 spy</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_spy</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        ExampleService spyExampleService = spy(<span class="keyword">new</span> ExampleService());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 默认会走真实方法</span></span><br><span class="line">        Assert.assertEquals(<span class="number">3</span>, spyExampleService.add(<span class="number">1</span>, <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 打桩后，不会走了</span></span><br><span class="line">        when(spyExampleService.add(<span class="number">1</span>, <span class="number">2</span>)).thenReturn(<span class="number">10</span>);</span><br><span class="line">        Assert.assertEquals(<span class="number">10</span>, spyExampleService.add(<span class="number">1</span>, <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 但是参数比匹配的调用，依然走真实方法</span></span><br><span class="line">        Assert.assertEquals(<span class="number">3</span>, spyExampleService.add(<span class="number">2</span>, <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试 mock</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_mock</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        ExampleService mockExampleService = mock(ExampleService.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 默认返回结果是返回类型int的默认值</span></span><br><span class="line">        Assert.assertEquals(<span class="number">0</span>, mockExampleService.add(<span class="number">1</span>, <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>spy 对应注解 @Spy，和 @Mock 是一样用的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Assert;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.mockito.MockitoAnnotations;</span><br><span class="line"><span class="keyword">import</span> org.mockito.Spy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.mockito.Mockito.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExampleService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a+b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MockitoDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Spy</span></span><br><span class="line">    <span class="keyword">private</span> ExampleService spyExampleService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_spy</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        MockitoAnnotations.initMocks(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        Assert.assertEquals(<span class="number">3</span>, spyExampleService.add(<span class="number">1</span>, <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">        when(spyExampleService.add(<span class="number">1</span>, <span class="number">2</span>)).thenReturn(<span class="number">10</span>);</span><br><span class="line">        Assert.assertEquals(<span class="number">10</span>, spyExampleService.add(<span class="number">1</span>, <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>对于@Spy，如果发现修饰的变量是 null，会自动调用类的无参构造函数来初始化。</p>
<p>所以下面两种写法是等价的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 写法1</span></span><br><span class="line"><span class="meta">@Spy</span></span><br><span class="line"><span class="keyword">private</span> ExampleService spyExampleService;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写法2</span></span><br><span class="line"><span class="meta">@Spy</span></span><br><span class="line"><span class="keyword">private</span> ExampleService spyExampleService = <span class="keyword">new</span> ExampleService();</span><br></pre></td></tr></table></figure>
<p>如果没有无参构造函数，必须使用写法2。例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.Assert;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.mockito.MockitoAnnotations;</span><br><span class="line"><span class="keyword">import</span> org.mockito.Spy;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExampleService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> a;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ExampleService</span><span class="params">(<span class="keyword">int</span> a)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.a = a;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a+b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MockitoDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Spy</span></span><br><span class="line">    <span class="keyword">private</span> ExampleService spyExampleService = <span class="keyword">new</span> ExampleService(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_spy</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        MockitoAnnotations.initMocks(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        Assert.assertEquals(<span class="number">3</span>, spyExampleService.add(<span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-4-使用-InjectMocks-注解"><a href="#2-4-使用-InjectMocks-注解" class="headerlink" title="2.4 使用 @InjectMocks 注解"></a>2.4 使用 @InjectMocks 注解</h3><p>@InjectMocks 这个Mock可以调用真实代码的方法，其余用@Mock（或@Spy）注解创建的mock将被注入到该实例中。<br>参见：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/bb705a56f620">https://www.jianshu.com/p/bb705a56f620</a></p>
<h2 id="3-验证性测试"><a href="#3-验证性测试" class="headerlink" title="3.验证性测试"></a>3.验证性测试</h2><p>Mockito 测试框架中提供了 Mockito.verify 静态方法让我们可以方便的进行验证性测试，比如方法调用验证、方法调用次数验证、方法调用顺序验证等，下面看看具体的代码。</p>
<h3 id="3-1-验证方法单次调用"><a href="#3-1-验证方法单次调用" class="headerlink" title="3.1.验证方法单次调用"></a>3.1.验证方法单次调用</h3><p>验证方法单次调用的话直接 verify 方法后加上待验证调用方法即可，以下代码的功能就是验证 mockList 对象的 size 方法被调用一次。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExtendWith(MockitoExtension.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MockitoVerifyTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Mock</span></span><br><span class="line">    List&lt;String&gt; mockList;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">verify_SimpleInvocationOnMock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mockList.size(); <span class="comment">//方法调用</span></span><br><span class="line">        verify(mockList).size(); <span class="comment">//验证方法调用次数</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-2-验证方法调用指定次数"><a href="#3-2-验证方法调用指定次数" class="headerlink" title="3.2.验证方法调用指定次数"></a>3.2.验证方法调用指定次数</h3><p>除了验证单次调用，我们有时候还需要验证一些方法被调用多次或者指定的次数，那么此时就可以使用 verify + times 方法来验证方法调用指定次数，同时还可以结合 atLeast + atMost 方法来提供调用次数范围，同时还有 never 等方法验证不被调用等。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExtendWith(MockitoExtension.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MockitoVerifyTest</span> </span>&#123;  </span><br><span class="line">    <span class="meta">@Mock</span>  </span><br><span class="line">    List&lt;String&gt; mockList; </span><br><span class="line">     </span><br><span class="line">    <span class="meta">@Test</span>  </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">verify_NumberOfInteractionsWithMock</span><span class="params">( &#123;    </span></span></span><br><span class="line"><span class="function"><span class="params">        mockList.size()</span></span>;    </span><br><span class="line">        mockList.size();    </span><br><span class="line">        verify(mockList, times(<span class="number">2</span>)).size();</span><br><span class="line">        verify(mockList, atLeast(<span class="number">1</span>)).size();</span><br><span class="line">        verify(mockList, atMost(<span class="number">10</span>)).size();  </span><br><span class="line">    &#125;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="3-2-验证方法调用顺序"><a href="#3-2-验证方法调用顺序" class="headerlink" title="3.2 验证方法调用顺序"></a>3.2 验证方法调用顺序</h3><p>可以使用 inOrder 方法来验证方法的调用顺序，下面示例验证 mockList 对象的 size、add 和 clear 方法的调用顺序。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExtendWith(MockitoExtension.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MockitoVerifyTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Mock</span></span><br><span class="line">    List&lt;String&gt; mockList;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">verify_OrderedInvocationsOnMock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mockList.size();</span><br><span class="line">        mockList.add(<span class="string">&quot;add a parameter&quot;</span>);</span><br><span class="line">        mockList.clear();</span><br><span class="line"></span><br><span class="line">        InOrder inOrder = inOrder(mockList);</span><br><span class="line">        inOrder.verify(mockList).size();</span><br><span class="line">        inOrder.verify(mockList).add(<span class="string">&quot;add a parameter&quot;</span>);</span><br><span class="line">        inOrder.verify(mockList).clear();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>###3.3 验证方法异常<br>Mockito提供了when(…).thenXXX(…)来让我们定义方法调用行为，以下代码定义了当调用mockMap的get方法无论传入任何参数都会抛出一个NPE异常，然后通过Assertions.assertThrows来验证调用结果。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExtendWith(MockitoExtension.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MockitoExceptionTest</span> </span>&#123;  </span><br><span class="line"><span class="meta">@Mock</span>  </span><br><span class="line"><span class="keyword">public</span> Map&lt;String, Integer&gt; mockMap;  </span><br><span class="line"><span class="meta">@Test</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whenConfigNonVoidReturnMethodToThrowEx_thenExIsThrown</span><span class="params">()</span> </span>&#123;    </span><br><span class="line">    when(mockMap.get(anyString())).thenThrow(NullPointerException.class);   </span><br><span class="line">    assertThrows(NullPointerException.class, () -&gt;    mockMap.get(<span class="string">&quot;mghio&quot;</span>)); </span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里有一点需要注意，使用以上这种方式定义的 mock 对象测试实际并不会影响到对象的内部状态,如下面的样例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MockitoTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Mock</span></span><br><span class="line">    List&lt;String&gt; mockList;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add_spyMockList_thenAffect</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mockList.add(<span class="string">&quot;mghio&quot;</span>);</span><br><span class="line">        assertEquals(<span class="number">0</span>, mockList.size());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>虽然我们已经在 mockList 对象上调用了 add 方法，但是实际上 mockList 集合中并没有加入 mghio，这时候如果需要对 mock 对象<strong>有影响</strong>，那么需要使用 spy 方式来生成 mock 对象。</p>
<h2 id="4-与Spring框架集成"><a href="#4-与Spring框架集成" class="headerlink" title="4.与Spring框架集成"></a>4.与Spring框架集成</h2><p>Mockito 框架提供了 @MockBean 注解用来将 mock 对象注入到 Spring 容器中，该对象会替换容器中任何现有的相同类型的 bean，该注解在需要模拟特定bean（例如外部服务）的测试场景中很有用。<br>如果使用的是 Spring Boot 2.0+ 并且当前容器中已有相同类型的 bean 的时候，需要设置 spring.main.allow-bean-definition-overriding 为 true（默认为 false）允许 bean 定义覆盖。下面假设要测试通过用户编码查询用户的信息，有一个数据库操作层的 UserRepository，也就是我们等下要 mock 的对象，定义如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserRepository</span> </span>&#123;  </span><br><span class="line">    <span class="function">User <span class="title">findUserById</span><span class="params">(Long id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>还有用户操作的相关服务 UserService 类，其定义如下所示:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepository;          </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserService</span><span class="params">(UserRepository userRepository)</span> </span>&#123;    </span><br><span class="line">        <span class="keyword">this</span>.userRepository = userRepository;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findUserById</span><span class="params">(Long id)</span></span>&#123;    </span><br><span class="line">        <span class="keyword">return</span> userRepository.findUserById(id);  </span><br><span class="line">    &#125;&#125;</span><br></pre></td></tr></table></figure>
<p>在测试类中使用 @MockBean 来标注 UserRepository 属性表示这个类型的 bean 使用的是 mock 对象，使用 @Autowired 标注表示 UserService 属性使用的是 Spring 容器中的对象，然后使用 @SpringBootTest 启用 Spring 环境即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceUnitTest</span> </span>&#123;  </span><br><span class="line"><span class="meta">@Autowired</span>  </span><br><span class="line"><span class="keyword">private</span> UserService userService;  </span><br><span class="line"><span class="meta">@MockBean</span>  </span><br><span class="line"><span class="keyword">private</span> UserRepository userRepository;  </span><br><span class="line"><span class="meta">@Test</span>  </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">whenUserIdIsProvided_thenRetrievedNameIsCorrect</span><span class="params">()</span> </span>&#123;    </span><br><span class="line">    User expectedUser = <span class="keyword">new</span> User(<span class="number">9527L</span>, <span class="string">&quot;mghio&quot;</span>, <span class="string">&quot;18288888880&quot;</span>);    </span><br><span class="line">    when(userRepository.findUserById(<span class="number">9527L</span>)).thenReturn(expectedUser);    </span><br><span class="line">    User actualUser =   userService.findUserById(<span class="number">9527L</span>);    </span><br><span class="line">    assertEquals(expectedUser, actualUser); </span><br><span class="line"> &#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-Mockito框架的工作原理"><a href="#5-Mockito框架的工作原理" class="headerlink" title="5.Mockito框架的工作原理"></a>5.Mockito框架的工作原理</h2><p> Mockito 非常容易使用并且可以方便的验证一些方法的行为，相信你已经看出来了，使用的步骤是先创建一个需要 mock 的对象 Target ，该对象如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Target</span> </span>&#123;  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">foo</span><span class="params">(String name)</span> </span>&#123;    </span><br><span class="line">        <span class="keyword">return</span> String.format(<span class="string">&quot;Hello, %s&quot;</span>, name);  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>然后直接调用Mockito.mock方法和 when().thenXXX()方法生成mock对象并指定方法调用时的行为，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test_foo</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">    String expectedResult = <span class="string">&quot;Mocked mghio&quot;</span>;     </span><br><span class="line">    when(mockTarget.foo(<span class="string">&quot;mghio&quot;</span>)).thenReturn(expectedResult);  </span><br><span class="line">    String actualResult = mockTarget.foo(<span class="string">&quot;mghio&quot;</span>);  </span><br><span class="line">    assertEquals(expectedResult, actualResult);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>需要注意的是when()方法参数是方法的调用。是因为当我们调用 mock 对象的 foo 方法时，Mockito 会拦截方法的调用然后将方法调用的详细信息保存到 mock 对象的上下文中，当调用到 Mockito.when 方法时，实际上是从该上下文中获取最后一个注册的方法调用，然后把 thenReturn 的参数作为其返回值保存，然后当我们的再次调用 mock 对象的该方法时，之前已经记录的方法行为将被再次回放，该方法触发拦截器重新调用并且返回我们在 thenReturn 方法指定的返回值。简而言之，Mockito 框架通过方法拦截在上下文中存储和检索方法调用详细信息来工作的。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li><a target="_blank" rel="noopener" href="http://ifeve.com/%E4%B8%80%E6%96%87%E8%AE%A9%E4%BD%A0%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B-mockito-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6/">一文让你快速上手 Mockito 单元测试框架</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/bb705a56f620">@InjectMocks
</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/u011047968/article/details/91970070?utm_medium=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromBaidu-1.control&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromBaidu-1.control">Mockito的使用（二）——@InjectMocks、@Spy、@Mock
</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/12/16/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Robinson">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Road To Excelsior">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/12/16/hello-world/" class="post-title-link" itemprop="url">Hello World</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-12-16 00:19:31" itemprop="dateCreated datePublished" datetime="2020-12-16T00:19:31+08:00">2020-12-16</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/04/24/Java-Reflection/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Robinson">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Road To Excelsior">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/24/Java-Reflection/" class="post-title-link" itemprop="url">Java Reflection</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-04-24 00:00:00" itemprop="dateCreated datePublished" datetime="2019-04-24T00:00:00+08:00">2019-04-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-18 00:46:50" itemprop="dateModified" datetime="2020-12-18T00:46:50+08:00">2020-12-18</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>反射是Java语言的一种特性。它被用来在<strong>运行时</strong>检查或者修改方法，类，接口的行为。</p>
<ul>
<li>反射所需要的类 reflection 在java.lang.reflect包中；</li>
<li>反射提供了一个对象所属的类信息以及可供运行的对象的方法的信息；</li>
<li>通过反射，可以在运行时调用指定的方法，而无视它们所用的访问限定符；</li>
</ul>
<h2 id="获取类，构造器，方法信息"><a href="#获取类，构造器，方法信息" class="headerlink" title="获取类，构造器，方法信息"></a>获取类，构造器，方法信息</h2><ul>
<li><code>Class</code>{:.error} getClass() 方法被用来获取某个对象所属类的名称</li>
<li><code>Constructors</code>{:.error} getConstructors方法可以被用来获取某个对象所属类的公有构造器信息</li>
<li><code>Methods</code>{:.error} getMethods() 方法被用来获取某个对象所属于类的公有方法信息</li>
</ul>
<p>例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo;</span><br><span class="line"></span><br><span class="line"><span class="comment">// class whose object is to be created</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="comment">// creating a private field</span></span><br><span class="line">    <span class="keyword">private</span> String s;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// creating a public constructor</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Test</span><span class="params">()</span>  </span>&#123;  s = <span class="string">&quot;GeeksforGeeks&quot;</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Creating a public method with no arguments</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method1</span><span class="params">()</span>  </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;The string is &quot;</span> + s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Creating a public method with int as argument</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">method2</span><span class="params">(<span class="keyword">int</span> n)</span>  </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;The number is &quot;</span> + n);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// creating a private method</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">method3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Private method invoked&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>构建一个方法来为这个类生成对象;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Creating object whose property is to be checked</span></span><br><span class="line">        Test obj = <span class="keyword">new</span> Test();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Creating class object from the object using</span></span><br><span class="line">        <span class="comment">// getclass method</span></span><br><span class="line">        Class cls = obj.getClass();</span><br><span class="line">        System.out.println(<span class="string">&quot;The name of class is &quot;</span> +</span><br><span class="line">                cls.getName());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Getting the constructor of the class through the</span></span><br><span class="line">        <span class="comment">// object of the class</span></span><br><span class="line">        Constructor constructor = cls.getConstructor();</span><br><span class="line">        System.out.println(<span class="string">&quot;The name of constructor is &quot;</span> +</span><br><span class="line">                constructor.getName());</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;The public methods of class are : &quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Getting methods of the class through the object</span></span><br><span class="line">        <span class="comment">// of the class by using getMethods</span></span><br><span class="line">        Method[] methods = cls.getMethods();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Printing method names</span></span><br><span class="line">        <span class="keyword">for</span> (Method method : methods)</span><br><span class="line">            System.out.println(method.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">````</span><br><span class="line"></span><br><span class="line">观察结果可见：</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">The name of <span class="class"><span class="keyword">class</span> <span class="title">is</span> <span class="title">com</span>.<span class="title">example</span>.<span class="title">demo</span>.<span class="title">Test</span></span></span><br><span class="line"><span class="class"><span class="title">The</span> <span class="title">name</span> <span class="title">of</span> <span class="title">constructor</span> <span class="title">is</span> <span class="title">com</span>.<span class="title">example</span>.<span class="title">demo</span>.<span class="title">Test</span></span></span><br><span class="line">The public methods of class are : </span><br><span class="line">method1</span><br><span class="line">method2</span><br><span class="line">wait</span><br><span class="line">wait</span><br><span class="line">wait</span><br><span class="line">equals</span><br><span class="line">toString</span><br><span class="line">hashCode</span><br><span class="line">getClass</span><br><span class="line">notify</span><br><span class="line">notifyAll</span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>需要说明如下几点：</p>
<ol>
<li>因为Java中所有的类都继承Object，所以公有方法中有一些是Object类中的方法列表；</li>
<li>除了获取上面一些信息，还能获取类的成员变量信息，方法的参数列表信息，返回值信息，异常信息等</li>
</ol>
<h2 id="调用反射调用类，构造器，方法"><a href="#调用反射调用类，构造器，方法" class="headerlink" title="调用反射调用类，构造器，方法"></a>调用反射调用类，构造器，方法</h2><p>承接上个代码案例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: fuxi</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2019/4/24</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Creating object whose property is to be checked</span></span><br><span class="line">        Test obj = <span class="keyword">new</span> Test();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Creating class object from the object using</span></span><br><span class="line">        <span class="comment">// getclass method</span></span><br><span class="line">        Class cls = obj.getClass();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// creates object of desired method by providing the</span></span><br><span class="line">        <span class="comment">// method name and parameter class as arguments to</span></span><br><span class="line">        <span class="comment">// the getDeclaredMethod</span></span><br><span class="line">        Method methodcall1 = cls.getDeclaredMethod(<span class="string">&quot;method2&quot;</span>,</span><br><span class="line">                <span class="keyword">int</span>.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// invokes the method at runtime</span></span><br><span class="line">        methodcall1.invoke(obj, <span class="number">19</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// creates object of the desired field by providing</span></span><br><span class="line">        <span class="comment">// the name of field as argument to the</span></span><br><span class="line">        <span class="comment">// getDeclaredField method</span></span><br><span class="line">        Field field = cls.getDeclaredField(<span class="string">&quot;s&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// allows the object to access the field irrespective</span></span><br><span class="line">        <span class="comment">// of the access specifier used with the field</span></span><br><span class="line">        field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// takes object and the new value to be assigned</span></span><br><span class="line">        <span class="comment">// to the field as arguments</span></span><br><span class="line">        field.set(obj, <span class="string">&quot;JAVA&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Creates object of desired method by providing the</span></span><br><span class="line">        <span class="comment">// method name as argument to the getDeclaredMethod</span></span><br><span class="line">        Method methodcall2 = cls.getDeclaredMethod(<span class="string">&quot;method1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// invokes the method at runtime</span></span><br><span class="line">        methodcall2.invoke(obj);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Creates object of the desired method by providing</span></span><br><span class="line">        <span class="comment">// the name of method as argument to the</span></span><br><span class="line">        <span class="comment">// getDeclaredMethod method</span></span><br><span class="line">        Method methodcall3 = cls.getDeclaredMethod(<span class="string">&quot;method3&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// allows the object to access the method irrespective</span></span><br><span class="line">        <span class="comment">// of the access specifier used with the method</span></span><br><span class="line">        methodcall3.setAccessible(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// invokes the method at runtime</span></span><br><span class="line">        methodcall3.invoke(obj);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>运行查看代码的结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">The number is <span class="number">19</span></span><br><span class="line">The string is JAVA</span><br><span class="line">Private method invoked</span><br></pre></td></tr></table></figure>

<p>通过代码，可以观察到一下几点：</p>
<ul>
<li>如果知道方法的名称和参数类型，可以通过反射来获取这个方法。可以使用getDeclaredMethod()，来创建一个待调用的方法对象。</li>
<li>可以通过invoke方法来在运行时调用指定类的方法。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 在具有指定参数的指定对象上调用此对象表示的基础方法。</span></span><br><span class="line"><span class="comment">* 各个参数自动解包以匹配原始形式参数，并且原始参数和引用参数都根据需要进行方法调用转换。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object obj, Object... args)</span></span>&#123;...&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>通过反射，可以获取私有变量和私有方法，并使用上诉方法来调用这些私有变量和私有方法。具体的话，使用以下两个步骤来达到目的：<ol>
<li><strong>Class.getDeclaredField(FieldName):</strong> 被用来获取私有成员。这个方法用来返回一个指定字段名称的Field类型的对象。</li>
<li><strong>Field.setAccessible(true):</strong> 无论字段使用的访问修饰符如何，都允许访问该字段。</li>
</ol>
</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>使用反射的优势在哪里：</p>
<ul>
<li><strong>可扩展性功能</strong>：应用程序可以通过使用完全限定名称创建可扩展性对象的实例来使用外部的用户定义类。</li>
<li><strong>调试和测试工具</strong>：调试器使用反射的一些性质来检查私有类和方法。</li>
</ul>
<p>使用反射的劣势在哪里：</p>
<ul>
<li><strong>性能损耗</strong>：反射操作的性能低于非反射操作，应避免使用在对性能敏感的应用程序中频繁调用的代码段中。</li>
<li><strong>封装暴露</strong>：反射代码打破了抽象，因此可能会通过升级平台来改变行为。</li>
</ul>
<p>关于对反射知识的总结，我是在阅读Java注解以及Spring AOP时，发现这些技术都使用了反射作为运行时代码信息获取执行的基础，所以就回过头来阅读相关的文档。具体关于注解方面的资源，可见：<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/briblue/article/details/73824058">Java 注解 （Annotation）</a></p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol>
<li><a target="_blank" rel="noopener" href="https://www.geeksforgeeks.org/reflection-in-java/">Reflection in Java</a></li>
<li><a target="_blank" rel="noopener" href="https://www.oracle.com/technetwork/articles/java/javareflection-1536171.html">Using Java Reflection</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/04/21/Unit-Test/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Robinson">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Road To Excelsior">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/21/Unit-Test/" class="post-title-link" itemprop="url">单元测试</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-04-21 00:00:00" itemprop="dateCreated datePublished" datetime="2019-04-21T00:00:00+08:00">2019-04-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-05-08 15:53:10" itemprop="dateModified" datetime="2019-05-08T15:53:10+08:00">2019-05-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="1-单元测试"><a href="#1-单元测试" class="headerlink" title="1.单元测试"></a>1.单元测试</h2><h3 id="1-1-什么是单元测试？"><a href="#1-1-什么是单元测试？" class="headerlink" title="1.1 什么是单元测试？"></a>1.1 什么是单元测试？</h3><p><strong>单元测试</strong>是开发者编写的一小段代码，用于检测被测代码的一个很小的、很明确的的功能是否正常。</p>
<h3 id="1-2-一般原则"><a href="#1-2-一般原则" class="headerlink" title="1.2 一般原则"></a>1.2 一般原则</h3><ol>
<li>测试任何可能失败的地方。</li>
<li>测试任何已经失败的地方。</li>
<li>对于新加的代码，在被证明正确之前，都可能是有问题的。</li>
<li>至少编写和产品代码一样多的测试代码。</li>
<li>针对每次编译都做局部测试。</li>
<li>签入代码之前做全局测试。</li>
</ol>
<h2 id="2-使用Junit来进行单元测试"><a href="#2-使用Junit来进行单元测试" class="headerlink" title="2.使用Junit来进行单元测试"></a>2.使用Junit来进行单元测试</h2><p>测试代码<code>必须</code>{:.error}要做以下这几件事情：</p>
<ul>
<li>准备测试所需要的各种条件（创建所有必须的对象，分配必要的资源等等）。</li>
<li>调用要测试的方法。</li>
<li>验证被测试方法的行为和期望是否一致。</li>
<li>完成后清理各种资源</li>
</ul>
<h2 id="3-测试哪些内容：Right-BICEP"><a href="#3-测试哪些内容：Right-BICEP" class="headerlink" title="3.测试哪些内容：Right-BICEP"></a>3.测试哪些内容：Right-BICEP</h2><h3 id="3-1-Right-结果是否正确？"><a href="#3-1-Right-结果是否正确？" class="headerlink" title="3.1 Right-结果是否正确？"></a>3.1 Right-结果是否正确？</h3><ul>
<li>如果代码能够运行正确，我要怎么才知道它是正确的呢？</li>
<li>使用数据文件。</li>
</ul>
<h3 id="3-2-B-是否所有的边界条件都是正确的？"><a href="#3-2-B-是否所有的边界条件都是正确的？" class="headerlink" title="3.2 B-是否所有的边界条件都是正确的？"></a>3.2 B-是否所有的边界条件都是正确的？</h3><p>一个想到可能得边界条件的简单办法是记住短语CORRECT。</p>
<ul>
<li>Conformance（一致性） – 值是否和预期一致。</li>
<li>Ordering（顺序性）– 值是否如应该的那样，是有序或者无序的。</li>
<li>Range（区间性） – 值是否位于合理的最小值和最大值之内。</li>
<li>Reference（依赖性）– 代码是否引用了一些不在代码本身控制范围之内的外部资源。</li>
<li>Existence（存在性） – 值是否存在（例如，是否是非null, 非0， 在一个集合中等等）。</li>
<li>Cardinatity(基数性) – 是否恰好有足够的值？</li>
<li>Time（相对或者绝对的时间性）– 所有事情的发生是否是有序的？是否是在正确的时刻？是否恰好及时？</li>
</ul>
<h3 id="3-3-I-能查一下反向关联吗？"><a href="#3-3-I-能查一下反向关联吗？" class="headerlink" title="3.3 I-能查一下反向关联吗？"></a>3.3 I-能查一下反向关联吗？</h3><p>对于一些方法，我们可以使用反向的逻辑关系来验证它们。<br>需要注意的是：当你同时编写原方法和它的反向测试时，一些bug可能会被在两个函数中都出现的错误所掩盖。在可能的情况下，应该使用不同的原理来编写反向测试。</p>
<h3 id="3-4-C-能用其他手段交叉检查一下结果吗？"><a href="#3-4-C-能用其他手段交叉检查一下结果吗？" class="headerlink" title="3.4 C-能用其他手段交叉检查一下结果吗？"></a>3.4 C-能用其他手段交叉检查一下结果吗？</h3><p>你同样可能使用其他的手段来交叉检查函数的结果。比如使用一些比较弱的版本来检查我们新写的新版本函数效果。</p>
<h3 id="3-5-E-你是否可以强制错误条件的发生？"><a href="#3-5-E-你是否可以强制错误条件的发生？" class="headerlink" title="3.5 E-你是否可以强制错误条件的发生？"></a>3.5 E-你是否可以强制<strong>错误条件</strong>的发生？</h3><p>使用Mock对象来模拟错误条件来产生各种条件：</p>
<ul>
<li>内存耗光</li>
<li>磁盘用满</li>
<li>时钟出问题</li>
<li>网络不可用或者有问题</li>
<li>系统过载</li>
<li>显示分辨率过高或过低</li>
</ul>
<h3 id="3-6-P-是否满足性能要求？"><a href="#3-6-P-是否满足性能要求？" class="headerlink" title="3.6 P-是否满足性能要求？"></a>3.6 P-是否满足性能要求？</h3><p>考虑使用JUnitPerf等工具来进行性能测试。</p>
<h2 id="4-使用mock来模拟对象"><a href="#4-使用mock来模拟对象" class="headerlink" title="4.使用mock来模拟对象"></a>4.使用mock来模拟对象</h2><p>参见文档: <a target="_blank" rel="noopener" href="http://www.importnew.com/24741.html">Junit mockito 解耦合测试</a></p>
<h2 id="5-好的测试所具有的品质"><a href="#5-好的测试所具有的品质" class="headerlink" title="5.好的测试所具有的品质"></a>5.好的测试所具有的品质</h2><p>好的测试应该具有如下的品质，合称为A-TRIP:</p>
<ul>
<li>自动化（Automatic)<ul>
<li>调用测试自动化</li>
<li>检查结果自动化</li>
</ul>
</li>
<li>彻底的（Thorough）<ul>
<li>完整度测试</li>
</ul>
</li>
<li>可重复（Repeatable）<ul>
<li>每个测试必须独立其他的测试，而且还必须独立于周围的环境。</li>
</ul>
</li>
<li>独立的（Independent）<ul>
<li>一次只测试了一样东西（一个测试函数应该专注于代码产品中的一个函数），或者组合起来并共同提供某个特性的一组函数</li>
<li>测试没有依赖于其他任何的测试; 这里可以使用<code>Mockito</code>{:.error}</li>
<li>每个测试方法的setUp 以及teardown函数，以及每个类的setup函数和teardown函数帮助实现了这个特性</li>
<li><code>每个测试都应该是一座孤岛</code>{:.error}</li>
</ul>
</li>
<li>专业的（Professional）</li>
</ul>
<h3 id="5-1-对测试进行测试"><a href="#5-1-对测试进行测试" class="headerlink" title="5.1 对测试进行测试"></a>5.1 对测试进行测试</h3><p>如何保证测试代码是正确的：</p>
<ul>
<li>在修正bug的同时改进测试。</li>
<li>通过引入bug来证明测试。</li>
</ul>
<p>步骤：</p>
<ol>
<li>验明 bug。</li>
<li>编写一个将失败的测试来证明 bug 的存在。</li>
<li>修正代码，让测试通过。</li>
<li>验证所有的测试依然可以通过。（也就是，你没有在修补的时候损坏其他的测试）</li>
<li>这种方法能够持续有效的增长测试覆盖率，而从已经存在的代码中逃脱到荒漠的bug的数目会同时下井。</li>
</ol>
<h2 id="6-开发者对单元测试的自我修养"><a href="#6-开发者对单元测试的自我修养" class="headerlink" title="6.开发者对单元测试的自我修养"></a>6.开发者对单元测试的自我修养</h2><h3 id="6-1-宗旨："><a href="#6-1-宗旨：" class="headerlink" title="6.1 宗旨："></a>6.1 宗旨：</h3><ol>
<li>需要避免养成<code>忽略</code>{:.error}”失败的测试结果”的习惯。</li>
<li><code>所有的测试应该在任何时刻都能通过</code>{:.error}</li>
</ol>
<h3 id="6-2-如何遵循这些宗旨呢？"><a href="#6-2-如何遵循这些宗旨呢？" class="headerlink" title="6.2 如何遵循这些宗旨呢？"></a>6.2 如何遵循这些宗旨呢？</h3><ol>
<li>不完整的代码（比如说，仅嵌入了一个类文件，而忘记了它所依赖的其他文件）。</li>
<li>不能编译的代码。</li>
<li>代码能编译，但是会破坏已经存在的代码，比如使得已经存在的代码编译失败。</li>
<li>没有相应单元测试的代码。</li>
<li>不能通过单元测试的代码。</li>
<li>通过了自己的测试，但是导致系统其他地方的其他测试失败的代码。</li>
</ol>
<h3 id="6-3-测试的频率的一般性原则："><a href="#6-3-测试的频率的一般性原则：" class="headerlink" title="6.3 测试的频率的一般性原则："></a>6.3 测试的频率的一般性原则：</h3><ol>
<li>编写新的函数。</li>
</ol>
<ul>
<li>编译并运行本地的单元测试。</li>
</ul>
<ol start="2">
<li>修正bug。</li>
</ol>
<ul>
<li>关于修正bug的单元测试的流程，见 <em>5.1</em>。</li>
</ul>
<ol start="3">
<li>每次成功编译之后。</li>
</ol>
<ul>
<li>运行本地的单元测试。</li>
</ul>
<ol start="4">
<li>每次对版本控制的签入。</li>
</ol>
<ul>
<li>运行所有的模块或者系统的单元的测试。</li>
</ul>
<ol start="5">
<li>通过持续构建工具来持续不断地测试。</li>
</ol>
<h3 id="6-4-测试与遗留代码"><a href="#6-4-测试与遗留代码" class="headerlink" title="6.4 测试与遗留代码"></a>6.4 测试与遗留代码</h3><h3 id="6-5-测试与评审"><a href="#6-5-测试与评审" class="headerlink" title="6.5 测试与评审"></a>6.5 测试与评审</h3><p>无论进行何种形式的代码评审，都要让<code>测试代码成为评审过程的一个组成部分</code>{:.error}。</p>
<h2 id="7-设计话题"><a href="#7-设计话题" class="headerlink" title="7.设计话题"></a>7.设计话题</h2><h3 id="7-1-测试驱动的设计"><a href="#7-1-测试驱动的设计" class="headerlink" title="7.1 测试驱动的设计"></a>7.1 测试驱动的设计</h3><p>如果你总是在编写实现代码之前，就先编写它们的测试代码，那么你就是在使用测试驱动的开发这么一种很有用的技术。这种编码方式的一个优点是，你可以享受到”测试驱动的设计”的好处，并且大大改善接口的设计。</p>
<p>因为总是自己亲自来调用这些接口，所以通常都能获得更好的接口设计。正如一句谚语所说 – 你总是能够利用这些反馈来改善接口的设计。</p>
<h3 id="7-2-测试无效的参数"><a href="#7-2-测试无效的参数" class="headerlink" title="7.2 测试无效的参数"></a>7.2 测试无效的参数</h3><p>原则：<code>别让野蛮人进门</code>{:.error}。</p>
<h2 id="8-个人经验总结"><a href="#8-个人经验总结" class="headerlink" title="8. 个人经验总结"></a>8. 个人经验总结</h2><ol>
<li><p>对于Java service程序，dao层可以通过事务自动回滚来保证对数据库的无侵犯性；其他层，如manager层，service层等，可以通过Mock工具来保证单元测试的独立性和可重复性。</p>
</li>
<li><p>对于web程序，可以通过Mockito, MockMVC, JUnit来配合使用进行controller层的定制化单元测试。</p>
</li>
</ol>
<p>歪个楼：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/633d83dd303b">Spring MVC @JsonView使用详解</a></p>
<h2 id="9-参考文献"><a href="#9-参考文献" class="headerlink" title="9.参考文献"></a>9.参考文献</h2><ul>
<li>《单元测试之道 Java版》</li>
<li>Mockito介绍:<ul>
<li><a target="_blank" rel="noopener" href="https://javacodehouse.com/blog/mockito-tutorial/">How to mock with Mockito (A comprehensive guide with examples)</a></li>
<li><a target="_blank" rel="noopener" href="http://youngfor.me/2017/07/30/mockito-spy/">Mockito Spy 用法</a></li>
<li><a target="_blank" rel="noopener" href="https://site.mockito.org/">Mockito官网</a></li>
<li><a target="_blank" rel="noopener" href="https://memorynotfound.com/unit-test-spring-mvc-rest-service-junit-mockito/">Unit Test Spring MVC Rest Service: MockMVC, JUnit, Mockito</a></li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/04/19/How-to-design-a-good-API/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Robinson">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Road To Excelsior">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/19/How-to-design-a-good-API/" class="post-title-link" itemprop="url">How to design a good API and why it matters?</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-04-19 00:00:00" itemprop="dateCreated datePublished" datetime="2019-04-19T00:00:00+08:00">2019-04-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-18 00:46:40" itemprop="dateModified" datetime="2020-12-18T00:46:40+08:00">2020-12-18</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-前言"><a href="#1-前言" class="headerlink" title="1.前言"></a>1.前言</h1><h2 id="1-1-为什么接口设计很重要？"><a href="#1-1-为什么接口设计很重要？" class="headerlink" title="1.1.为什么接口设计很重要？"></a>1.1.为什么接口设计很重要？</h2><ul>
<li>API可能是一个公司最重要的资产<ul>
<li>用户花了很多心血：购买，使用，学习等</li>
<li>停止使用API的成本可能很高</li>
<li>成功的公开API能够抓住用户</li>
</ul>
</li>
<li>API也可能是公司最大的责任之一<ul>
<li>糟糕的API会导致无休止的技术支持需求</li>
</ul>
</li>
<li>公开的API是永久性的 - 只有一次机会保证其正确</li>
</ul>
<h2 id="1-2-为何接口设计对于你很重要？"><a href="#1-2-为何接口设计对于你很重要？" class="headerlink" title="1.2.为何接口设计对于你很重要？"></a>1.2.为何接口设计对于你很重要？</h2><ul>
<li>如果你是程序员，你就是一个API 设计者<ul>
<li>好的代码是模块化的 - 每个模块有一个API</li>
</ul>
</li>
<li>有用的模块往往会被重用<ul>
<li>一旦模块有用户，则不能随意更改API</li>
<li>良好的可重用模块是企业资产</li>
</ul>
</li>
<li>在API设计上进行思考可提高代码质量</li>
</ul>
<h2 id="1-3-优秀的API的特点"><a href="#1-3-优秀的API的特点" class="headerlink" title="1.3.优秀的API的特点"></a>1.3.优秀的API的特点</h2><ul>
<li>易于学习</li>
<li>易于使用，即便没有文档</li>
<li>很难被误用</li>
<li>易于阅读和维护使用它的代码</li>
<li>足够强大到满足需求</li>
<li>易于扩展</li>
<li>适合受众</li>
</ul>
<h1 id="2-概况"><a href="#2-概况" class="headerlink" title="2.概况"></a>2.概况</h1><h2 id="2-1-API设计的流程"><a href="#2-1-API设计的流程" class="headerlink" title="2.1.API设计的流程"></a>2.1.API设计的流程</h2><h3 id="2-1-1-以合理的怀疑态度收集需求"><a href="#2-1-1-以合理的怀疑态度收集需求" class="headerlink" title="2.1.1 以合理的怀疑态度收集需求"></a>2.1.1 以合理的怀疑态度收集需求</h3><ul>
<li>通常你会得到建议的解决方案<ul>
<li>更好的方案可能存在</li>
</ul>
</li>
<li>你的工作是提取出真实的需求<ul>
<li>应采用用户案例的形式</li>
</ul>
</li>
<li>构建一个更加通用的API是更简单，且更有价值的</li>
</ul>
<h3 id="2-1-2-以简短的细则开始-1页足够"><a href="#2-1-2-以简短的细则开始-1页足够" class="headerlink" title="2.1.2 以简短的细则开始 - 1页足够"></a>2.1.2 以简短的细则开始 - 1页足够</h3><ul>
<li>在这个阶段，敏捷是胜过完整性的</li>
<li>将细则在尽可能多的人之间传播<ul>
<li>听取他们的输入，并且慎重对待</li>
</ul>
</li>
<li>如果保持细则简短，则易于修改</li>
<li>持续更新这个细则</li>
</ul>
<h3 id="2-1-3-尽早，经常写入你的API"><a href="#2-1-3-尽早，经常写入你的API" class="headerlink" title="2.1.3 尽早，经常写入你的API"></a>2.1.3 尽早，经常写入你的API</h3><ul>
<li>在实现之前开始设计API<ul>
<li>可以避免会被丢弃的实现</li>
</ul>
</li>
<li>在细则完全确定之前开始设计API<ul>
<li>可以避免会被丢弃的细则</li>
</ul>
</li>
<li>持续地更新你的API<ul>
<li>避免令人讨厌的惊喜</li>
<li>代码依靠样例和单元测试存活</li>
</ul>
</li>
</ul>
<h3 id="2-1-4-写入SPI-Service-Provider-Interface-更为重要"><a href="#2-1-4-写入SPI-Service-Provider-Interface-更为重要" class="headerlink" title="2.1.4 写入SPI(Service Provider Interface)更为重要"></a>2.1.4 写入SPI(Service Provider Interface)更为重要</h3><ul>
<li>Service Provider Interface(SPI) 关于SPI介绍，参见: <a target="_blank" rel="noopener" href="https://juejin.im/post/5af952fdf265da0b9e652de3">JavaSPI机制介绍</a><ul>
<li>插件接口，可支持多种实现</li>
</ul>
</li>
<li>在发布前，编写多个插件<ul>
<li>如果只写一个插件，可能不能支持另外一个</li>
<li>如果写两个插件，可能支持更多的（需求）</li>
<li>如果写三个插件，可能就能正常工作</li>
</ul>
</li>
</ul>
<h3 id="2-1-5-维护现实的期望"><a href="#2-1-5-维护现实的期望" class="headerlink" title="2.1.5 维护现实的期望"></a>2.1.5 维护现实的期望</h3><ul>
<li>大多数API设计都过度约束了<ul>
<li>你不能使每个人满意</li>
<li>只需要平等的对待每一个人的需求</li>
</ul>
</li>
<li>期望会犯错误<ul>
<li>一段时间的真实调用会将这些错误冲刷掉</li>
<li>期待能持续发展API</li>
</ul>
</li>
</ul>
<h2 id="2-2-设计原则"><a href="#2-2-设计原则" class="headerlink" title="2.2.设计原则"></a>2.2.设计原则</h2><h3 id="2-2-1-API应该只做一件事情，并且做好这件事情"><a href="#2-2-1-API应该只做一件事情，并且做好这件事情" class="headerlink" title="2.2.1 API应该只做一件事情，并且做好这件事情"></a>2.2.1 API应该只做一件事情，并且做好这件事情</h3><ul>
<li>API的功能应该非常容易解释<ul>
<li>如果很难命名API，这可能是一个坏的标志</li>
<li>好的命名驱动着开发</li>
<li>易于拆分和合并模块</li>
</ul>
</li>
</ul>
<h3 id="2-2-2-API应该尽可能的小"><a href="#2-2-2-API应该尽可能的小" class="headerlink" title="2.2.2 API应该尽可能的小"></a>2.2.2 API应该尽可能的小</h3><ul>
<li>API应该满足它的需求</li>
<li>当存在疑问时，放弃这个API<ul>
<li>功能，方法，类，参数等</li>
<li><code>你永远可以添加，但是决不能移除</code>{:.error}</li>
</ul>
</li>
<li>概念比实体更加重要</li>
<li>寻找良好的能效比</li>
</ul>
<h3 id="2-2-3-实现不应该影响API"><a href="#2-2-3-实现不应该影响API" class="headerlink" title="2.2.3 实现不应该影响API"></a>2.2.3 实现不应该影响API</h3><ul>
<li>实现细节<ul>
<li>会迷惑用户</li>
<li>限制改变实现的自由</li>
</ul>
</li>
<li>了解什么是实现细节<ul>
<li>不要过度指定方法的行为</li>
<li>例子：不要指定hash函数的细节</li>
<li>所有可调整的参数都是可疑的</li>
</ul>
</li>
<li>不要让实现的细节<code>&quot;泄露&quot;</code>{:.error}到API</li>
</ul>
<h3 id="2-2-4-最小化所有对象的可访问性"><a href="#2-2-4-最小化所有对象的可访问性" class="headerlink" title="2.2.4 最小化所有对象的可访问性"></a>2.2.4 最小化所有对象的可访问性</h3><ul>
<li>使类和成员变量尽可能是Private的</li>
<li>公有类不应该有公有成员变量（常量除外）</li>
<li>这样可以最大化信息隐藏</li>
<li>允许独立使用，理解，构建，测试和调试模块</li>
</ul>
<h3 id="2-2-5-命名很重要-API是一种小语言"><a href="#2-2-5-命名很重要-API是一种小语言" class="headerlink" title="2.2.5 命名很重要 - API是一种小语言"></a>2.2.5 命名很重要 - API是一种小语言</h3><ul>
<li>名称需要最大化自解释性<ul>
<li>避免神秘的缩写</li>
</ul>
</li>
<li>保持一致 - 相同的单词意味着相同的事情<ul>
<li>这个原则是横跨所有API的，跨平台的</li>
</ul>
</li>
<li>定期争取对称性</li>
<li>代码需要像散文一样</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (car.speed() &gt; <span class="number">2</span> * SPEED_LIMIT)</span><br><span class="line">  generateAlert(<span class="string">&quot;Watch out for cops!&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="2-2-6-文档很重要"><a href="#2-2-6-文档很重要" class="headerlink" title="2.2.6 文档很重要"></a>2.2.6 文档很重要</h3><blockquote>
<p>重用是说起来容易做起来难的事情。实现重用需要好的设计以及非常好的文档。即便我们看到好的设计（这是不常见的），如果没有好的文档，也不会实现目标中的代码重用。</p>
</blockquote>
<h3 id="2-2-7-文档的宗旨"><a href="#2-2-7-文档的宗旨" class="headerlink" title="2.2.7 文档的宗旨"></a>2.2.7 文档的宗旨</h3><ul>
<li>为每个类，接口，方法，构造器，参数以及异常编写文档<ul>
<li>类：这个类实例代表什么</li>
<li>方法：方法和客户端之间的契约<ul>
<li>前置条件，后置条件，副作用</li>
</ul>
</li>
<li>参数：表明单位，类型，所有权</li>
</ul>
</li>
<li>非常仔细地记录状态空间</li>
</ul>
<h3 id="2-2-8-考虑API设计决策的性能后果"><a href="#2-2-8-考虑API设计决策的性能后果" class="headerlink" title="2.2.8 考虑API设计决策的性能后果"></a>2.2.8 考虑API设计决策的性能后果</h3><ul>
<li>错误的决策会影响性能<ul>
<li>使类型是可变的</li>
<li>提供构造器而不是静态工厂，参见：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/8b6f21cf0ca3">考虑用静态工厂方法代替构造器</a></li>
<li>使用实现类型而不是接口类型，参见：<a target="_blank" rel="noopener" href="https://blog.csdn.net/summerxiachen/article/details/79733800">实现类型vs 接口类型</a></li>
</ul>
</li>
<li>不要包装API以获得性能<ul>
<li>潜在的性能问题可能会被解决，但是造成的后遗症是永久的</li>
<li>好的设计通常拥有优秀的性能</li>
</ul>
</li>
</ul>
<h3 id="2-2-9-API设计决策对性能的影响是真实和永久的"><a href="#2-2-9-API设计决策对性能的影响是真实和永久的" class="headerlink" title="2.2.9 API设计决策对性能的影响是真实和永久的"></a>2.2.9 API设计决策对性能的影响是真实和永久的</h3><ul>
<li>Component.getSize()返回 Dimension</li>
<li>Dimension是可变的，每次调用getSize都会分配一个Dimension，所以造成了百万次无用的对象分配</li>
<li>替代版本在1.2添加，但是旧的客户端代码依旧很慢</li>
</ul>
<h3 id="2-2-10-API必须与平台和平共存"><a href="#2-2-10-API必须与平台和平共存" class="headerlink" title="2.2.10 API必须与平台和平共存"></a>2.2.10 API必须与平台和平共存</h3><ul>
<li>做到习惯做法<ul>
<li>遵循标准的命名传统</li>
<li>避免使用过时的参数和返回类型</li>
<li>模仿核心API和语言中的模式</li>
</ul>
</li>
<li>利用对API友好的特性<ul>
<li>泛型，变量，枚举，默认参数</li>
</ul>
</li>
<li>了解并避免API陷阱和缺陷<ul>
<li>Finalizers, public static final arrays</li>
</ul>
</li>
</ul>
<h2 id="2-3-类设计"><a href="#2-3-类设计" class="headerlink" title="2.3.类设计"></a>2.3.类设计</h2><h3 id="2-3-1-最小化可变性"><a href="#2-3-1-最小化可变性" class="headerlink" title="2.3.1 最小化可变性"></a>2.3.1 最小化可变性</h3><ul>
<li>除非有必要，否则类应该是不可变的<ul>
<li>优势：简单，线程安全，可重用</li>
<li>劣势：对于每个值都有独立的对象</li>
</ul>
</li>
<li>如果是可变的，保证状态空间尽可能小，定义明确的<ul>
<li>明确何时调用哪种方法是合法的</li>
</ul>
</li>
</ul>
<p>正面案例：TimerTask<br>反面案例：Date, Calendar</p>
<h3 id="2-3-2-只在有意义时创建子类"><a href="#2-3-2-只在有意义时创建子类" class="headerlink" title="2.3.2 只在有意义时创建子类"></a>2.3.2 只在有意义时创建子类</h3><ul>
<li>子类意味着可替代性<ul>
<li>只在存在一对多的(is-a)的关系时运行创建子类</li>
<li>否则，使用组合</li>
</ul>
</li>
<li>公共类不应该为了便于实现，而为其他公共类创建子类</li>
</ul>
<p>反面案例：Stack extends Vector<br>        Properties extends Hashtable<br>正面案例：Set extends Collection</p>
<h3 id="2-3-3-对于继承需要设计和文档，否则就禁止"><a href="#2-3-3-对于继承需要设计和文档，否则就禁止" class="headerlink" title="2.3.3 对于继承需要设计和文档，否则就禁止"></a>2.3.3 对于继承需要设计和文档，否则就禁止</h3><ul>
<li>继承违反了封装原则<ul>
<li>子类对于父类的实现细节是敏感的</li>
</ul>
</li>
<li>如果你允许创建子类，则文档自用<ul>
<li>方法如何相互使用</li>
</ul>
</li>
<li>保守政策：所有的具体类都是final的 参见: <a target="_blank" rel="noopener" href="http://www.importnew.com/7553.html">深入理解Java中的final关键字</a></li>
</ul>
<p>反面案例：Many concrete classes in J2SE libraries<br>正面案例：AbstractSet, AbstractMap</p>
<h2 id="2-4-方法设计"><a href="#2-4-方法设计" class="headerlink" title="2.4.方法设计"></a>2.4.方法设计</h2><h3 id="2-4-1-不要让客户端做任何模块可以做的事情"><a href="#2-4-1-不要让客户端做任何模块可以做的事情" class="headerlink" title="2.4.1 不要让客户端做任何模块可以做的事情"></a>2.4.1 不要让客户端做任何模块可以做的事情</h3><ul>
<li>减少对样板代码的需求<ul>
<li>通常可以通过剪切-粘贴的方式完成</li>
<li>丑陋，误导，且容易出错</li>
</ul>
</li>
</ul>
<p>样例代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.w3c.dom.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.*;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.dom.*;</span><br><span class="line"><span class="keyword">import</span> javax.xml.transform.stream.*;</span><br><span class="line"> <span class="comment">// DOM code to write an XML document to a specified output stream.</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">writeDoc</span><span class="params">(Document doc, OutputStream out)</span><span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    Transformer t = TransformerFactory.newInstance().newTransformer();</span><br><span class="line">    t.setOutputProperty(OutputKeys.DOCTYPE_SYSTEM, doc.getDoctype().getSystemId());</span><br><span class="line">    t.transform(<span class="keyword">new</span> DOMSource(doc), <span class="keyword">new</span> StreamResult(out));</span><br><span class="line">  &#125; <span class="keyword">catch</span>(TransformerException e) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> AssertionError(e); <span class="comment">// Can’t happen!</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的代码，关于javax.xml模块的相关客户端代码可以移除。</p>
<h3 id="2-4-2-不要违反最小惊讶原则"><a href="#2-4-2-不要违反最小惊讶原则" class="headerlink" title="2.4.2 不要违反最小惊讶原则"></a>2.4.2 不要违反最小惊讶原则</h3><ul>
<li>API的使用不应该被其行为惊讶<ul>
<li>这个原则值得额外的实现成本</li>
<li>这个原则也值得降低性能</li>
</ul>
</li>
</ul>
<p>反面样例：<br><img src="/assets/posts/api-design/Thread.png"></p>
<h3 id="2-4-3-为所有可访问字段数据提供String-形式的程序访问方法"><a href="#2-4-3-为所有可访问字段数据提供String-形式的程序访问方法" class="headerlink" title="2.4.3 为所有可访问字段数据提供String 形式的程序访问方法"></a>2.4.3 为所有可访问字段数据提供String 形式的程序访问方法</h3><ul>
<li>否则，客户端需要解析出字符串<ul>
<li>对于客户端来说是痛苦的</li>
<li>更糟糕的是，将字符串格式变成了事实上的API</li>
</ul>
</li>
</ul>
<p>正反面样例：<br><img src="/assets/posts/api-design/Throwable.png"></p>
<h3 id="2-4-4-慎重地进行重载"><a href="#2-4-4-慎重地进行重载" class="headerlink" title="2.4.4 慎重地进行重载"></a>2.4.4 慎重地进行重载</h3><ul>
<li>避免模糊的重载行为<ul>
<li>对于同一个实际行为写了多个重载</li>
<li>保守原则：相同数目的参数不要有两个（重载方法）</li>
</ul>
</li>
<li>仅仅因为你可以并不代表你应该这样做<ul>
<li>这个时候一般使用另一个名称会更好</li>
</ul>
</li>
<li>如果你提供了模糊的重载，保证相同的参数产生相同的行为</li>
</ul>
<p>反面案例：<br><img src="/assets/posts/api-design/TreeSet.png"></p>
<h3 id="2-4-5-使用合适的参数类型和返回类型"><a href="#2-4-5-使用合适的参数类型和返回类型" class="headerlink" title="2.4.5 使用合适的参数类型和返回类型"></a>2.4.5 使用合适的参数类型和返回类型</h3><ul>
<li>对于输入，相较与类，鼓励使用接口类型<ul>
<li>提供了灵活性，性能</li>
</ul>
</li>
<li>使用最具体的输入参数类型<ul>
<li>将错误从运行时移到了编译时</li>
</ul>
</li>
<li>如果存在更合适的类型，不要使用String<ul>
<li>String是笨重的，易出错的，慢的</li>
</ul>
</li>
<li>不要使用float类型用于货币价值<ul>
<li>双浮点数容易造成不准确的结果</li>
</ul>
</li>
<li>使用double(64 bits)而不是float(32 bit)<ul>
<li>精度丢失是真实的，而性能并没有提升多少</li>
</ul>
</li>
</ul>
<h3 id="2-4-6-在方法中保持一致的参数顺序"><a href="#2-4-6-在方法中保持一致的参数顺序" class="headerlink" title="2.4.6 在方法中保持一致的参数顺序"></a>2.4.6 在方法中保持一致的参数顺序</h3><ul>
<li>特别是在参数类型相同的情况下<br>反面案例:<br><img src="/assets/posts/api-design/copy.png"><br>正面案例:<br><img src="/assets/posts/api-design/parameter.png"></li>
</ul>
<h3 id="2-4-7-避免长的参数列表"><a href="#2-4-7-避免长的参数列表" class="headerlink" title="2.4.7 避免长的参数列表"></a>2.4.7 避免长的参数列表</h3><ul>
<li>三个或更少的参数比较理想<ul>
<li>如果过多，用户就需要去参考文档了</li>
</ul>
</li>
<li>对于过长的，且类型相同的参数列表是有伤害性的<ul>
<li>程序员可能错误地转置参数</li>
<li>程序可能会正常的编译，运行，但是行为错误了</li>
</ul>
</li>
<li>两种缩短参数列表的方法<ul>
<li>将方法拆分</li>
<li>创建helper class来存储参数<br>反面案例：<br><img src="/assets/posts/api-design/toolongparameter.png"></li>
</ul>
</li>
</ul>
<h3 id="2-4-8-避免返回需要异常处理的返回值"><a href="#2-4-8-避免返回需要异常处理的返回值" class="headerlink" title="2.4.8  避免返回需要异常处理的返回值"></a>2.4.8  避免返回需要异常处理的返回值</h3><ul>
<li>返回0长度的列表，或空集合，而不是null<br>反面样例：<br><img src="/assets/posts/api-design/nullexamper.png"></li>
</ul>
<h2 id="2-5-异常设计"><a href="#2-5-异常设计" class="headerlink" title="2.5.异常设计"></a>2.5.异常设计</h2><h3 id="2-5-1-抛出异常以表明特殊情况"><a href="#2-5-1-抛出异常以表明特殊情况" class="headerlink" title="2.5.1 抛出异常以表明特殊情况"></a>2.5.1 抛出异常以表明特殊情况</h3><ul>
<li>不要强迫客户端使用异常来控制流程</li>
</ul>
<p>反面案例:<br><img src="/assets/posts/api-design/flowControl.png"></p>
<ul>
<li>相反，不要无声地失败</li>
</ul>
<p>反面案例：<br><img src="/assets/posts/api-design/ThreadGroup.png"></p>
<h3 id="2-5-2-赞成未受检的异常"><a href="#2-5-2-赞成未受检的异常" class="headerlink" title="2.5.2 赞成未受检的异常"></a>2.5.2 赞成未受检的异常</h3><ul>
<li>Checked - 客户端必须采用恢复措施</li>
<li>Unchecked - 程序错误</li>
<li>过度使用受检异常会导致样板代码(boilerplate)</li>
</ul>
<p>反面样例：<br><img src="/assets/posts/api-design/uncheck.png"></p>
<h3 id="2-5-3-需要在异常中保存失败的捕捉信息"><a href="#2-5-3-需要在异常中保存失败的捕捉信息" class="headerlink" title="2.5.3 需要在异常中保存失败的捕捉信息"></a>2.5.3 需要在异常中保存失败的捕捉信息</h3><ul>
<li>便于诊断和恢复</li>
<li>对于未受检异常，消息就足够了</li>
<li>对于受检异常，请提供访问者信息</li>
</ul>
<h2 id="2-6-重构API设计"><a href="#2-6-重构API设计" class="headerlink" title="2.6.重构API设计"></a>2.6.重构API设计</h2><p>向量中的子列表操作：<br><img src="/assets/posts/api-design/vector.png"></p>
<ul>
<li>不是很强大 - 只支持搜索</li>
<li>没有文档的话，很难使用</li>
</ul>
<p>重构这个操作：<br><img src="/assets/posts/api-design/subList.png"></p>
<ul>
<li>非常强大 - 支持所有的操作</li>
<li>使用接口，降低了概念的重量<ul>
<li>提高了概念的能效比</li>
</ul>
</li>
<li>没有文档，也能简单使用</li>
</ul>
<h1 id="3-总结"><a href="#3-总结" class="headerlink" title="3.总结"></a>3.总结</h1><ul>
<li>API设计是一个严肃且有回报的工艺<ul>
<li>改善了很多编程者，终端用户，公司等</li>
</ul>
</li>
<li>这篇文档涵盖了一些该工艺的启发式方法<ul>
<li>不要无脑附和</li>
<li>在没有合理的原因的情况下，也不要违背</li>
</ul>
</li>
<li>API设计很难<ul>
<li>它不是一个单独的过程</li>
<li>完美是不存在的，但是可以持续改进</li>
</ul>
</li>
</ul>
<h1 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h1><ol>
<li><a href="/assets/posts/api-design/a.pdf">How to design a good API and why it matters</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2019/04/09/Isolation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Robinson">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Road To Excelsior">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/04/09/Isolation/" class="post-title-link" itemprop="url">数据库中的隔离</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-04-09 00:00:00" itemprop="dateCreated datePublished" datetime="2019-04-09T00:00:00+08:00">2019-04-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-12-18 00:45:26" itemprop="dateModified" datetime="2020-12-18T00:45:26+08:00">2020-12-18</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h1><p>在数据库系统中，隔离性表示了事务的完整性对用户和其他系统的可见程度。举个例子，比如说一个用户创建了一个订单，并且已经创建了抬头，但是没有创建订单详情列表，那么这个抬头信息对于其他系统/用户(包含是一个并发操作，像是订单报告)是可见的呢？</p>
<p>一个低级别的隔离增加了更多用户同时对数据的可见性，但是也增加了一些用户可能碰到的并发问题（例如脏读，或者更新丢失的问题）。相反，较高的隔离级别会减少用户可能遇到的并发问题，但需要更多系统资源并增加一个事务阻止另一个事务的可能性。</p>
<p>隔离通常在数据库级别定义为一个属性，用于定义一个操作所做的更改如何/何时对其他操作可见。在较旧的系统上，它可以系统地实现，例如通过使用临时表。在双层系统中，需要事务处理（TP）管理器来维护隔离。在n层系统中（例如多个网站试图预订航班上的最后一个座位），需要结合存储过程和交易管理来提交预订并向客户发送确认。</p>
<p>隔离是ACID（原子性，一致性，隔离性，耐久性）属性之一。</p>
<h2 id="并发控制"><a href="#并发控制" class="headerlink" title="并发控制"></a>并发控制</h2><p>并发控制包括DBMS中的底层机制，它处理隔离并保证相关的正确性。数据库和存储引擎（见上文）大量使用它来保证并发事务的正确执行，以及（不同的机制）其他DBMS进程的正确性。与事务相关的机制通常将数据库数据访问操作的时间（事务调度）约束为特定的时序模型，这些时序模型通常包含可序列化，和可恢复的特性。约束数据库访问操作执行通常意味着降低的性能（执行速率），因此并发控制机制通常被设计为在约束下提供可能的最佳性能。通常，在不影响正确性的情况下，可序列化属性因为更好的性能需求通常会被破坏，但是，可恢复属性则不会被破坏，因为这个可能会导致数据库完整性被破坏。</p>
<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Two-phase_locking">两阶段锁定(two-phase locking)</a>是DBMS中最常用的事务并发控制方法，用于提供可序列化和可恢复性的正确性。为了访问数据库对象，事务首先需要获取该对象的锁。根据访问操作类型（例如，读取或写入对象）和锁定类型，如果另一个事务正在为该对象保持锁定，则可以阻止和推迟获取锁定。</p>
<h2 id="读现象"><a href="#读现象" class="headerlink" title="读现象"></a>读现象</h2><p>当事务1读取事务2可能已更改的数据时，ANSI / ISO标准SQL 92引用三种不同的读取现象。</p>
<p>在以下示例中，发生了两个事务。 在第一个中，执行查询1。 然后，在第二个事务中，执行并提交查询2。 最后，在第一个事务中，再次执行查询1。</p>
<p>查询使用了下面的数据库表user：</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>age</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Joe</td>
<td>20</td>
</tr>
<tr>
<td>2</td>
<td>Jill</td>
<td>25</td>
</tr>
</tbody></table>
<h3 id="脏读"><a href="#脏读" class="headerlink" title="脏读"></a>脏读</h3><p>当允许事务从已被另一个正在运行的事务修改但尚未提交的行读取数据时，会发生脏读（也称为未提交的依赖关系）。</p>
<p>脏读取与非可重复读取的工作方式类似; 但是，第二个事务不需要为第一个查询提交以返回不同的结果。在我们的示例中，事务2更改了一行，但未提交更改。 然后，事务1读取未提交的数据。 现在，如果事务2回滚其更改（已由事务1读取）或更新对数据库的不同更改，则事务1的记录中的数据视图可能是错误的。</p>
<p><img src="/assets/posts/Isolation/dirty-read.png">{:width=”600px” height=”400px”}</p>
<h3 id="不可重复读"><a href="#不可重复读" class="headerlink" title="不可重复读"></a>不可重复读</h3><p>发生不可重复的读取，当在事务过程中，行被检索两次并且行内的值在读取之间不同。</p>
<p>当执行SELECT时未获取读锁定时，或者在执行SELECT操作时 <strong>释放</strong> 受影响行上获取的锁定时，基于锁的并发控制方法中可能会发生不可重复读取现象。 在<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Multiversion_concurrency_control">多版本并发控制</a>方法下，当受到提交冲突影响的事务必须回滚的要求被放宽时，可能发生不可重复的读取。</p>
<p><img src="/assets/posts/Isolation/non-repeatable-read.png">{:width=”600px” height=”400px”}</p>
<p>在此示例中，事务2成功提交，这意味着它对id为1的行的更改应该变为可见。 但是，事务1已经在该行中看到了不同的年龄值。 在SERIALIZABLE和REPEATABLE READ隔离级别，DBMS对于第二个SELECT必须返回旧值。在READ COMMITTED和READ UNCOMMITTED，DBMS可以返回更新的值; 这是一个不可重复读的操作。</p>
<p>有两种基本策略用于防止不可重复的读取。 第一种是延迟事务2的执行，直到事务1已提交或回滚。 当使用锁时采用此方法，并生成串行调度T1，T2。 一个串行的计划表现出可重复的读取行为。</p>
<p>另外一种策略，在多版本并发控制中使用，T2允许被首先提交，这可以产生更好的并发性能。但是，T1，它开始早于T2，必须继续在数据库的过去版本上运行 - 这是它启动时的快照。当事务1最终尝试提交时，DBMS检查提交事务1的结果是否等于调度T1，T2。 如果是，则可以继续进行事务1。 但是，如果看不到它是等效的，则事务1必须以序列化失败的形式回滚。</p>
<p>在基于锁得并发控制方法中，在可重复读的隔离级别模式下，id = 1的行会被锁住，因此阻塞住查询Query 2直到第一个事务被提交或者回滚。在READ COMMITTED模式下，第二次Query 1被执行时，age字段就会被改变。</p>
<p>在基于多版本的并发控制方法中，在SERIALIZABLE隔离级别中，两个select 查询都会看到事务1开始时得数据库快照版本数据。因此，他们会返回相同的数据。但是，如果事务1也准备update这一行的话，一个序列化失败会出现，并且事务1将会强制回滚。</p>
<p>在READ COMMITTED 隔离级别，每个查询都会看到query开始时得一个快照版本。因此，它们对于更新的行都会看到不同的数据。在这种模式下，不会出现序列化失败错误，因为没有可序列化得承诺，并且不必重试事务1。</p>
<h3 id="幻读"><a href="#幻读" class="headerlink" title="幻读"></a>幻读</h3><p>当在事务过程中，新行被另一个事务添加或删除到正在读取的记录时，会发生幻像读取。</p>
<p>在执行SELECT … WHERE操作时未获取范围锁定时，可能会发生这种情况。当事务1重复一个范围的SELECT … WHERE查询时，并且，在两个操作之间，事务2创建（即INSERT）满足该WHERE子句的新行（在目标表中）,幻象读取是一非可重复读的一个特例。</p>
<p><img src="/assets/posts/Isolation/Phantom-read.png">{:width=”800px” height=”400px”}</p>
<p>请注意，事务1执行了两次相同的查询。 如果保持最高级别的隔离，则应同时返回相同的行集，实际上这是在SQL SERIALIZABLE隔离级别操作的数据库中强制要求的。 但是，在较小的隔离级别，第二次可以返回不同的行集。</p>
<p>在SERIALIZABLE隔离模式下，查询1将导致所有年龄在10到30范围内的记录被锁定，因此查询2将阻塞，直到第一个事务被提交。 在REPEATABLE READ模式下，范围不会被锁定，允许插入记录，第二次执行Query 1以在其结果中包含新行。</p>
<h2 id="隔离级别"><a href="#隔离级别" class="headerlink" title="隔离级别"></a>隔离级别</h2><p>在DBMS（数据库管理系统）中的四个ACID属性中，隔离属性是最常放松的属性。 在尝试保持最高级别的隔离时，DBMS通常会获取数据锁定，这可能会导致并发性丢失或实现多版本并发控制。 这需要添加逻辑以使应用程序正常运行。</p>
<p>大多数DBMS提供了许多事务隔离级别，这些级别控制选择数据时发生的锁定程度。 对于许多数据库应用程序，可以构造大多数数据库事务以避免需要高隔离级别（例如，SERIALIZABLE级别），从而减少系统的锁定开销。程序员必须仔细分析数据库访问代码，以确保任何放松隔离不会导致难以找到的软件错误。 相反，如果使用更高的隔离级别，则会增加死锁的可能性，这也需要仔细分析和编程技术以避免。</p>
<p>ANSI / ISO SQL标准定义的隔离级别如下所示。</p>
<h3 id="Serializable（可串行化）"><a href="#Serializable（可串行化）" class="headerlink" title="Serializable（可串行化）"></a>Serializable（可串行化）</h3><p>这是最高的隔离级别。</p>
<p>使用基于锁的并发控制DBMS实现，可序列化需要在事务结束时释放读取和写入锁（在所选数据上获取）。 当SELECT查询使用ranged WHERE子句时，也必须获取范围锁，尤其是为了避免幻像读取现象。</p>
<p>使用基于非锁定的并发控制时，不会获取锁定; 但是，如果系统检测到多个并发事务之间的写冲突，则只允许其中一个事务提交。 有关此主题的更多详细信息，请参阅快照隔离。</p>
<p>来自:(第二次非正式审查草案）ISO / IEC 9075：1992，数据库语言SQL- 1992年7月30日：保证隔离级别SERIALIZABLE的并发SQL事务的执行是可序列化的。 可序列化执行被定义为执行并发执行SQL事务的操作，这些操作产生与那些相同SQL事务的某些串行执行相同的效果。 串行执行是指每个SQL事务在下一个SQL事务开始之前执行完成的执行。</p>
<h3 id="Repeatable-reads（可重复读）"><a href="#Repeatable-reads（可重复读）" class="headerlink" title="Repeatable reads（可重复读）"></a>Repeatable reads（可重复读）</h3><p>在此隔离级别中，基于锁的并发控制DBMS实现保持读取和写入锁定（在选定数据上获取），直到事务结束。 但是，不管理范围锁定，因此可能会发生幻像读取。</p>
<p>在这种隔离级别写入偏移是可能得，这种现象是两个不同的写入者（他们之前已经读过他们正在更新的列）允许两个写入表中的同一列，从而导致列具有的数据是 这两笔交易的混合。</p>
<h3 id="Read-committed（读已提交）"><a href="#Read-committed（读已提交）" class="headerlink" title="Read committed（读已提交）"></a>Read committed（读已提交）</h3><p>在此隔离级别中，基于锁的并发控制DBMS实现保持写锁（在所选数据上获取）直到事务结束，但是一旦执行SELECT操作就会释放读锁（因此不可重复读取现象 可以发生在这种隔离级别）。与上一级别一样，不管理范围锁定。</p>
<p>换句话说，read committed是一个隔离级别，它保证读取时提交任何数据。 它只是限制读者看到任何中间的，未提交的，“脏”的读。 它没有任何承诺，如果事务重新发出读取，它将找到相同的数据; 数据在读取后可以自由更改。</p>
<h3 id="Read-uncommitted（读未提交）"><a href="#Read-uncommitted（读未提交）" class="headerlink" title="Read uncommitted（读未提交）"></a>Read uncommitted（读未提交）</h3><p>这是最低的隔离级别。在此级别中，允许脏读，因此一个事务可能会看到其他事务所做的尚未提交的更改。</p>
<p>由于每个隔离级别都比下面的隔离级别更强，因为没有更高的隔离级别允许更低级别的操作禁止，标准允许DBMS以比请求更强的隔离级别运行事务（例如，“读取已提交”） 事务实际上可以在“可重复读”隔离级别执行。</p>
<h2 id="缺省的隔离级别"><a href="#缺省的隔离级别" class="headerlink" title="缺省的隔离级别"></a>缺省的隔离级别</h2><p>不同DBMS的默认隔离级别变化很大。 大多数具有事务的数据库允许用户设置任何隔离级别。 在执行SELECT语句以获取锁时，某些DBMS还需要其他语法（例如，SELECT … FOR UPDATE以获取访问行上的独占写锁）。</p>
<p>但是，上述定义被批评为含糊不清，并且没有准确反映许多数据库提供的隔离：</p>
<blockquote>
<p>本文展示了定义隔离级别的异常方法中的一些缺点。 三种ANSI现象是模棱两可的，即使在他们最松散的解释中也不排除某些异常行为……这会导致一些反直觉的结果。 特别是，基于锁的隔离级别具有与ANSI等效的不同的特性。 这令人不安，因为商业数据库系统通常使用锁定实现。 另外，ANSI现象不区分商业系统中流行的多种类型的隔离级别行为。</p>
</blockquote>
<p>还有其他关于ANSI SQL的隔离定义的批评，因为它鼓励实现者做“坏事”：</p>
<blockquote>
<p>…它假设锁定模式用于并发控制，而不是乐观或多版本并发方案，它依赖于微妙的方式。这意味着所提出的语义是不明确的。</p>
</blockquote>
<h2 id="隔离级别，读现象，以及锁"><a href="#隔离级别，读现象，以及锁" class="headerlink" title="隔离级别，读现象，以及锁"></a>隔离级别，读现象，以及锁</h2><p>Isolation levels vs read phenomena<br><img src="/assets/posts/Isolation/isolation-level.png">{:width=”600px” height=”200px”}</p>
<p>如果所有事务都使用可重复读取或可序列化操作，则不会发生丢失更新。</p>
<p>Anomaly Serializable与Serializable不同。也就是说，Serializable计划应该没有所有三种现象类型，这是必要的，但还不够。</p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Isolation_(database_systems)#Non-repeatable_reads">Isolation (database systems)</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Robinson</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">32</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Robinson</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
